import{useContext as G}from"react";import{createContext as N}from"react";var U=N(void 0),S=N({});function s(t={}){let{throwOnMissingProvider:e=!0}=t,o=G(U);if(e){if(o===void 0)throw new Error("useUniformContext must be used within a <UniformContext> provider");return o}return o}import{useEffect as K,useState as Y}from"react";function zt(){let{context:t}=s(),[e,o]=Y(t.quirks),r=n=>{o(n)};return K(()=>(t.events.on("quirksUpdated",r),()=>{t.events.off("quirksUpdated",r)}),[t]),e}import{useEffect as Z,useState as $}from"react";import{dequal as tt}from"dequal/lite";function H(){let{context:t}=s(),[e,o]=$(t.scores);return Z(()=>{let r=p=>{o(p)},n=t.scores;return tt(e,n)||o(n),t.events.on("scoresUpdated",r),()=>{t.events.off("scoresUpdated",r)}},[t]),e}import F from"react";import y,{useMemo as et}from"react";function M({variations:t,component:e,wrapperComponent:o,name:r,count:n=1}){let{context:p}=s(),i=H(),{variations:f,personalized:x}=et(()=>p.personalize({name:r,variations:t,take:n}),[i,p,n,r,t]),T=o!=null?o:({children:l})=>y.createElement(y.Fragment,null,l),E=e;return y.createElement(S.Provider,{value:{personalized:!0}},f.length?y.createElement(T,{personalizationOccurred:x},f.map(l=>y.createElement(E,{key:l.id,personalizationResult:{variation:l,personalizationOccurred:x},...l}))):null)}import{ScriptType as h}from"@uniformdev/context";import C,{Fragment as nt}from"react";import{EdgeNodeTagName as ot}from"@uniformdev/context";import{createElement as rt}from"react";var d=t=>rt(ot,t);function A(t){let{variations:e,count:o,component:r}=t,n={count:o!=null?o:1},p=r;return C.createElement(C.Fragment,null,C.createElement(d,{"data-type":h.ListStart,dangerouslySetInnerHTML:{__html:JSON.stringify(n)}}),e.map(i=>C.createElement(nt,{key:i.id},C.createElement(d,{"data-type":h.ListItemSettings,dangerouslySetInnerHTML:{__html:JSON.stringify({id:i.id,pz:i.pz||null})}}),C.createElement(d,{"data-type":h.ListItem},C.createElement(p,{key:i.id,personalizationResult:{variation:i,personalizationOccurred:!1},...i})))),C.createElement(d,{"data-type":h.ListEnd}))}var g=typeof window=="undefined";function Zt(t){let{outputType:e}=s();return!g||e==="standard"?F.createElement(M,{...t}):e==="edge"?F.createElement(A,{...t}):null}import q from"react";import{ScriptType as k}from"@uniformdev/context";import P,{Fragment as it}from"react";function R(t){let{name:e,variations:o,component:r}=t,n={name:e},p=r;return P.createElement(P.Fragment,null,P.createElement(d,{"data-type":k.TestStart,dangerouslySetInnerHTML:{__html:JSON.stringify(n)}}),o.map((i,f)=>P.createElement(it,{key:i.id},P.createElement(d,{"data-type":k.ListItemSettings,dangerouslySetInnerHTML:{__html:JSON.stringify({id:i.id})}}),P.createElement(d,{"data-type":k.ListItem},P.createElement(p,{key:f,...i})))),P.createElement(d,{"data-type":k.TestEnd}))}import st from"react";var D=({name:t,variations:e,component:o})=>{let{context:r}=s(),{result:n}=r.test({name:t,variations:e});return n?st.createElement(o,{...n}):null};var Ce=t=>{let{outputType:e}=s();return!g||e==="standard"?q.createElement(D,{...t}):e==="edge"?q.createElement(R,{...t}):null};import L,{useEffect as at}from"react";import{SERVER_STATE_ID as mt}from"@uniformdev/context";import pt from"cookie";var he=({context:t,children:e,outputType:o="standard",trackRouteOnRender:r=!0})=>(at(()=>{g||!r||t.update({url:new URL(window.location.href),cookies:pt.parse(document.cookie)})}),L.createElement(U.Provider,{value:{context:t,outputType:o}},e,g?L.createElement(ft,null):null));function ft(){let{context:t}=s(),e={quirks:t.storage.data.quirks,tests:t.storage.data.tests,ssv:t.scores};return L.createElement("script",{id:mt,type:"application/json",dangerouslySetInnerHTML:{__html:JSON.stringify(e)}})}import{createElement as ct,useEffect as J,useRef as b,useState as B}from"react";import{useContext as ut}from"react";var O=t=>{let{personalized:e}=ut(S);return typeof e!="undefined"?e:typeof(t==null?void 0:t.personalized)!="undefined"?t.personalized:!1};var He=({behavior:t,children:e,tagName:o="div",threshold:r=.5,disableVisibilityTrigger:n=typeof window=="undefined"||!("IntersectionObserver"in window),...p})=>{let i=typeof document=="undefined"?"__uniform_ssr_url":document.location.href,{context:f}=s(),x=O(),[T,E]=B(),[l,V]=B(!1),v=b(null),u=b();return J(()=>{T!==i&&(V(!1),E(i))},[i,T]),J(()=>{var I;let _=!t||Array.isArray(t)&&!t.length;if(x||_||!v.current)return;let X=Array.isArray(t)?t:[t],w=()=>{var c;l||(f.update({enrichments:X}),V(!0),(c=u.current)==null||c.call(u))};if(n)w();else{(I=u.current)==null||I.call(u);let c=new IntersectionObserver(([z])=>{z.isIntersecting&&w()},{threshold:r});c.observe(v.current),u.current=()=>{var z;return(z=c.disconnect)==null?void 0:z.call(c)}}return()=>{var c;(c=u.current)==null||c.call(u)}},[f,t,n,r,x,T,i,l]),ct(o,{...p,ref:v},e)};import Q from"react";import{useEffect as W,useState as j}from"react";var Je=({behavior:t,children:e})=>{let o=typeof document=="undefined"?"__uniform_ssr_url":document.location.href,{context:r}=s(),n=O(),[p,i]=j(),[f,x]=j(!1);return W(()=>{p!==o&&(x(!1),i(o))},[o,p]),W(()=>{let T=!t||Array.isArray(t)&&!t.length;if(n||T)return;(()=>{if(f)return;let V=Array.isArray(t)?t:[t];r.update({enrichments:V}),x(!0)})()},[r,t,n,f]),Q.createElement(Q.Fragment,null,e)};export{Zt as Personalize,Ce as Test,He as Track,Je as TrackFragment,he as UniformContext,zt as useQuirks,H as useScores,s as useUniformContext};
