import{Track as g,TrackFragment as w,useUniformContext as b}from"@uniformdev/context-react";import{CANVAS_ENRICHMENT_TAG_PARAM as A}from"@uniformdev/canvas";import S,{createContext as k,useContext as V}from"react";function v(o){var n;let e=(n=o.parameters)!=null?n:{};return{...Object.keys(e).reduce((t,s)=>(t[s]=e[s].value,t),{}),...o.data,component:o}}var h=k(void 0);function T(){return V(h)}function N({data:o,resolveRenderer:e,children:r,behaviorTracking:n}){var p,a,f;let t=T(),s=b({throwOnMissingProvider:!1})!==void 0;if(!o)return process.env.NODE_ENV==="development"&&console.warn("[canvas-dev] Composition was rendered with no data, nothing will be output."),null;let i={composition:o,resolveRenderer:e!=null?e:t==null?void 0:t.resolveRenderer,behaviorTracking:(p=n!=null?n:t==null?void 0:t.behaviorTracking)!=null?p:"onView"},d=(f=(a=o.parameters)==null?void 0:a[A])==null?void 0:f.value,l=i.behaviorTracking==="onLoad"?w:g,m=typeof r=="function"?r(v(o)):r;return S.createElement(h.Provider,{value:i},s?S.createElement(l,{behavior:d},m):m)}import y from"react";import{CANVAS_PERSONALIZE_TYPE as D,CANVAS_TEST_TYPE as F}from"@uniformdev/canvas";import{Personalize as O,Test as _}from"@uniformdev/context-react";import{mapSlotToPersonalizedVariations as I,mapSlotToTestVariations as z}from"@uniformdev/canvas";import*as P from"react";var R={test:(o,e,r)=>{var d,l,m,p;let n=o,t=(l=(d=n.slots)==null?void 0:d.test)!=null?l:[],s=(p=(m=n.parameters.test)==null?void 0:m.value)!=null?p:"Untitled Test",i=z(t);return P.createElement(_,{key:e,variations:i,name:s,component:a=>r(a,e)})},personalization:(o,e,r)=>{var s,i,d,l,m,p,a;let n=o,t=I((s=n==null?void 0:n.slots)==null?void 0:s.pz);return P.createElement(O,{key:e,variations:t,count:Number((l=(d=(i=n.parameters)==null?void 0:i.count)==null?void 0:d.value)!=null?l:1),name:(a=(p=(m=n.parameters)==null?void 0:m.trackingEventName)==null?void 0:p.value)!=null?a:"Untitled Personalization",component:f=>r(f,0)})}};function po({name:o,resolveRenderer:e,children:r}){var p;let n=T();if(!(n!=null&&n.composition))throw new Error("Slot must be rendered within a Composition");let{composition:t,resolveRenderer:s}=n;if(!t)throw new Error("Cannot use Slot without a Composition wrapper.");let i=(p=t.slots)==null?void 0:p[o];if(!i||!Array.isArray(i))return process.env.NODE_ENV==="development"&&console.warn(`[canvas-dev] slot '${o}' was rendered, but it was not defined on its component. This is expected if the slot is optional, otherwise it may indicate a typo. Component:`,t),null;let d=e!=null?e:s,l=R,m=i.map((a,f)=>{let x=E({component:a,resolveRenderer:d,resolveSystem:l,key:f});return r?r({child:x,component:a,key:f}):x});return y.createElement(y.Fragment,void 0,m)}function E({component:o,resolveRenderer:e,resolveSystem:r,key:n=0}){let t=e==null?void 0:e(o);if(o.type===F)return r.test(o,n,(s,i)=>E({component:s,resolveRenderer:e,resolveSystem:r,key:i}));if(o.type===D)return r.personalization(o,n,(s,i)=>E({component:s,resolveRenderer:e,resolveSystem:r,key:i}));if(t){let s=v(o);return y.createElement(N,{key:n,data:o,resolveRenderer:e},y.createElement(t,{...s}))}else process.env.NODE_ENV!=="production"&&console.warn(`[canvas] found component of type '${o.type}' which the resolveRenderer prop returned no component for. Nothing will be rendered. The resolveRenderer function may need to be extended to handle the new type.`,o);return null}import c from"react";function lo(o){var r;let e=(r=o.component)==null?void 0:r.type;return e?c.createElement("div",{style:{borderLeft:"10px solid #e42535!important",padding:"0.01em 16px 16px",borderRadius:"16px",backgroundColor:"rgba(122, 215, 218, 0.3)",color:"#1d3557"}},c.createElement("h2",null,"Component: ",e),c.createElement("p",null,c.createElement("strong",null,e)," has no React implementation. It may need to be added to your"," ",c.createElement("code",null,"resolveRenderer()")," function."),c.createElement("details",null,c.createElement("summary",null,"Props"),c.createElement("pre",null,JSON.stringify(o,null,2)))):null}import{CANVAS_DRAFT_STATE as J,createEventBus as U,subscribeToComposition as X}from"@uniformdev/canvas";import{useEffect as K}from"react";function vo({enabled:o,projectId:e,compositionId:r,effect:n}){K(()=>{if(!o||!r||!e)return;let t;return(async()=>{let i=await U();i&&(t=X({eventBus:i,compositionId:r,compositionState:J,projectId:e,callback:n,event:"updated"}))})(),()=>{t&&t()}},[r,o,e,n])}export{N as Composition,lo as DefaultNotImplementedComponent,po as Slot,T as useComposition,vo as useCompositionEventEffect};
