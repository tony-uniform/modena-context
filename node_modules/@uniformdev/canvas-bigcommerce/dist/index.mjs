var P="/v3/catalog/products",h="/v3/catalog/categories/tree",R="/v3/catalog/brands",E=({storeHash:o,token:u})=>{let s=`https://api.bigcommerce.com/stores/${o}`,m=async e=>await(await fetch(e,{method:"GET",headers:{"X-Auth-Token":u}})).json();return{getProducts:async e=>{var c,n,i,l;let r=`${s}${P}`,t=new URL(r);return t.searchParams.set("include",(n=(c=e==null?void 0:e.include)==null?void 0:c.join(","))!=null?n:"images"),e!=null&&e.include_fields&&t.searchParams.set("include_fields",e.include_fields.join(",")),typeof e.limit!="undefined"&&t.searchParams.set("limit",e.limit.toString()),e.keyword&&t.searchParams.set("keyword",e.keyword),(i=e.categories)!=null&&i.length&&t.searchParams.set("categories:in",e.categories.join(",")),e.brand&&t.searchParams.set("brand_id",e.brand),e.sort&&t.searchParams.set("sort",e.sort),(l=e.ids)!=null&&l.length&&t.searchParams.set("id:in",e.ids.join(",")),e.sortOrder&&t.searchParams.set("direction",e.sortOrder),{products:(await m(t.toString())).data}},getProduct:async(e,r)=>{var n,i;let t=`${s}${P}`,a=new URL(t+"/"+e);return a.searchParams.set("include",(i=(n=r==null?void 0:r.include)==null?void 0:n.join(","))!=null?i:"images"),r!=null&&r.include_fields&&a.searchParams.set("include_fields",r.include_fields.join(",")),{product:(await m(a.toString())).data}},getCategories:async()=>{let e=`${s}${h}`;return{categories:(await m(e)).data}},getBrands:async()=>{let e=`${s}${R}`;return{brands:(await m(e)).data}}}};import{createLimitPolicy as y}from"@uniformdev/canvas";var j=Object.freeze(["bigcommerceProduct","bigcommerceProductQuery","bigcommerceProductList"]);function _({client:o,createProductOptions:u,createProductQueryOptions:s,limitPolicy:m}){return{enhanceOne:async({parameter:e,parameterName:r,component:t,context:a})=>{if(x(e)){let c=u==null?void 0:u({parameter:e,parameterName:r,component:t,context:a});try{return(await o.getProduct(e.value,c)).product}catch(n){throw new Error(`Failed loading BigCommerce entry ${e.value} ${n.toString()}`)}}else if(B(e)){let c=s==null?void 0:s({parameter:e,parameterName:r,component:t,context:a}),n={...e.value,limit:e.value.count,...c||{}};try{return(await o.getProducts(n)).products}catch(i){throw new Error(`Failed loading BigCommerce query ${e.value} ${i.toString()}`)}}else if(G(e)){let c={ids:e.value},n=s==null?void 0:s({parameter:e,parameterName:r,component:t,context:a}),i={...c,...n||{}};try{let f=(await o.getProducts(i)).products.reduce((d,g)=>(g.id&&(d[g.id]=g),d),{});return e.value.map(d=>f[d]).filter(d=>d)}catch(l){throw new Error(`Failed loading BigCommerce list ${e.value} ${l.toString()}`)}}},limitPolicy:m||y({throttle:{limit:2e4,interval:60*60*1e3}})}}function x(o){return o.type==="bigcommerceProduct"&&typeof o.value=="string"}function B(o){return o.type==="bigcommerceProductQuery"&&typeof o.value=="object"}function G(o){return o.type==="bigcommerceProductList"&&Array.isArray(o.value)}export{j as CANVAS_BIGCOMMERCE_PARAMETER_TYPES,E as createBigCommerceClient,_ as createBigCommerceEnhancer,x as parameterIsBigCommerceProduct,G as parameterIsBigCommerceProductList,B as parameterIsBigCommerceProductQuery};
