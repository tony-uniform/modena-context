var P=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var w=(t,s)=>{for(var o in s)P(t,o,{get:s[o],enumerable:!0})},b=(t,s,o,a)=>{if(s&&typeof s=="object"||typeof s=="function")for(let e of G(s))!E.call(t,e)&&e!==o&&P(t,e,{get:()=>s[e],enumerable:!(a=B(s,e))||a.enumerable});return t};var v=t=>b(P({},"__esModule",{value:!0}),t);var I={};w(I,{CANVAS_BIGCOMMERCE_PARAMETER_TYPES:()=>j,createBigCommerceClient:()=>T,createBigCommerceEnhancer:()=>_,parameterIsBigCommerceProduct:()=>h,parameterIsBigCommerceProductList:()=>y,parameterIsBigCommerceProductQuery:()=>R});module.exports=v(I);var C="/v3/catalog/products",O="/v3/catalog/categories/tree",$="/v3/catalog/brands",T=({storeHash:t,token:s})=>{let o=`https://api.bigcommerce.com/stores/${t}`,a=async e=>await(await fetch(e,{method:"GET",headers:{"X-Auth-Token":s}})).json();return{getProducts:async e=>{var m,i,c,l;let n=`${o}${C}`,r=new URL(n);return r.searchParams.set("include",(i=(m=e==null?void 0:e.include)==null?void 0:m.join(","))!=null?i:"images"),e!=null&&e.include_fields&&r.searchParams.set("include_fields",e.include_fields.join(",")),typeof e.limit!="undefined"&&r.searchParams.set("limit",e.limit.toString()),e.keyword&&r.searchParams.set("keyword",e.keyword),(c=e.categories)!=null&&c.length&&r.searchParams.set("categories:in",e.categories.join(",")),e.brand&&r.searchParams.set("brand_id",e.brand),e.sort&&r.searchParams.set("sort",e.sort),(l=e.ids)!=null&&l.length&&r.searchParams.set("id:in",e.ids.join(",")),e.sortOrder&&r.searchParams.set("direction",e.sortOrder),{products:(await a(r.toString())).data}},getProduct:async(e,n)=>{var i,c;let r=`${o}${C}`,d=new URL(r+"/"+e);return d.searchParams.set("include",(c=(i=n==null?void 0:n.include)==null?void 0:i.join(","))!=null?c:"images"),n!=null&&n.include_fields&&d.searchParams.set("include_fields",n.include_fields.join(",")),{product:(await a(d.toString())).data}},getCategories:async()=>{let e=`${o}${O}`;return{categories:(await a(e)).data}},getBrands:async()=>{let e=`${o}${$}`;return{brands:(await a(e)).data}}}};var f=require("@uniformdev/canvas"),j=Object.freeze(["bigcommerceProduct","bigcommerceProductQuery","bigcommerceProductList"]);function _({client:t,createProductOptions:s,createProductQueryOptions:o,limitPolicy:a}){return{enhanceOne:async({parameter:e,parameterName:n,component:r,context:d})=>{if(h(e)){let m=s==null?void 0:s({parameter:e,parameterName:n,component:r,context:d});try{return(await t.getProduct(e.value,m)).product}catch(i){throw new Error(`Failed loading BigCommerce entry ${e.value} ${i.toString()}`)}}else if(R(e)){let m=o==null?void 0:o({parameter:e,parameterName:n,component:r,context:d}),i={...e.value,limit:e.value.count,...m||{}};try{return(await t.getProducts(i)).products}catch(c){throw new Error(`Failed loading BigCommerce query ${e.value} ${c.toString()}`)}}else if(y(e)){let m={ids:e.value},i=o==null?void 0:o({parameter:e,parameterName:n,component:r,context:d}),c={...m,...i||{}};try{let x=(await t.getProducts(c)).products.reduce((u,g)=>(g.id&&(u[g.id]=g),u),{});return e.value.map(u=>x[u]).filter(u=>u)}catch(l){throw new Error(`Failed loading BigCommerce list ${e.value} ${l.toString()}`)}}},limitPolicy:a||(0,f.createLimitPolicy)({throttle:{limit:2e4,interval:60*60*1e3}})}}function h(t){return t.type==="bigcommerceProduct"&&typeof t.value=="string"}function R(t){return t.type==="bigcommerceProductQuery"&&typeof t.value=="object"}function y(t){return t.type==="bigcommerceProductList"&&Array.isArray(t.value)}0&&(module.exports={CANVAS_BIGCOMMERCE_PARAMETER_TYPES,createBigCommerceClient,createBigCommerceEnhancer,parameterIsBigCommerceProduct,parameterIsBigCommerceProductList,parameterIsBigCommerceProductQuery});
