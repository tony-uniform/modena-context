var p=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var P=(t,e)=>{for(var n in e)p(t,n,{get:e[n],enumerable:!0})},E=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of M(e))!x.call(t,r)&&r!==n&&p(t,r,{get:()=>e[r],enumerable:!(o=y(e,r))||o.enumerable});return t};var h=t=>E(p({},"__esModule",{value:!0}),t);var w={};P(w,{CANVAS_SFCMS_PARAMETER_TYPES:()=>V,createSalesforceCMSClient:()=>A,createSalesforceCMSEnhancer:()=>$,defaultSFCMSApiVersion:()=>S});module.exports=h(w);var l=require("@uniformdev/canvas"),V=Object.freeze(["sfcmsEntrySelector"]);function $({client:t,previewClient:e,createQuerystringParams:n,limitPolicy:o}){return e=e!=null?e:t,{enhanceOne:async({parameter:r,parameterName:a,component:g,context:s})=>{var i;if(T(r)){let c=s.preview?e:t,C=void 0;try{let m=n&&(i=n({parameter:r,parameterName:a,component:g,defaultQuerystringParams:C,context:s}))!=null?i:C;return await(c==null?void 0:c.getManagedContentVersion({managedContentId:r.value,querystringParams:m}))}catch(m){throw new Error(`Failed loading Salesforce CMS entry ${r.value} ${m.toString()}`)}}},limitPolicy:o!=null?o:(0,l.createLimitPolicy)({throttle:!1})}}function T(t){return t.type==="sfcmsEntrySelector"&&typeof t.value=="string"}var f=t=>{try{let e=JSON.parse(t);if(e&&typeof e=="object"&&e!==null)return e}catch(e){return e}return null};async function d(t){if(!t)return["Response was falsy"];try{let e=await t.text(),n=f(e);return n instanceof Error||!n?[e]:Array.isArray(n)?n.map(o=>o.message):[`${t.status} ${t.statusText}`]}catch(e){return console.warn("Couldn't parse API response for error, using status code instead",e),[`${t.status} ${t.statusText}`]}}var S="52.0",A=t=>({getManagedContentVersion:n=>R({...n,...t})});async function R({managedContentId:t,channelId:e,organizationId:n,instanceUrl:o,apiVersion:r,querystringParams:a}){o.startsWith("https://")||(o="https://"+o);let g=r||S,s=a?a.toString():"",i=`${o}/cms/delivery/v${g}/${e}/contents/${t}?oid=${n}&${s}`;return(await F(i)).items[0]}async function F(t,e="GET",n="application/json"){let r=await fetch(t,{method:e,headers:{"Content-Type":n||"application/json"}});if(!r.ok){let a=await d(r);throw new Error(`Error ${e}ing request to Salesforce CMS (url: ${t}) (contentType: ${n}) (statusCode: ${r.status}) : ${a.join(", ")}`)}return await r.json()}0&&(module.exports={CANVAS_SFCMS_PARAMETER_TYPES,createSalesforceCMSClient,createSalesforceCMSEnhancer,defaultSFCMSApiVersion});
