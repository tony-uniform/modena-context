import{createLimitPolicy as d}from"@uniformdev/canvas";var R=Object.freeze(["sfcmsEntrySelector"]);function F({client:t,previewClient:e,createQuerystringParams:n,limitPolicy:r}){return e=e!=null?e:t,{enhanceOne:async({parameter:o,parameterName:a,component:C,context:s})=>{var i;if(S(o)){let c=s.preview?e:t,m=void 0;try{let p=n&&(i=n({parameter:o,parameterName:a,component:C,defaultQuerystringParams:m,context:s}))!=null?i:m;return await(c==null?void 0:c.getManagedContentVersion({managedContentId:o.value,querystringParams:p}))}catch(p){throw new Error(`Failed loading Salesforce CMS entry ${o.value} ${p.toString()}`)}}},limitPolicy:r!=null?r:d({throttle:!1})}}function S(t){return t.type==="sfcmsEntrySelector"&&typeof t.value=="string"}var l=t=>{try{let e=JSON.parse(t);if(e&&typeof e=="object"&&e!==null)return e}catch(e){return e}return null};async function f(t){if(!t)return["Response was falsy"];try{let e=await t.text(),n=l(e);return n instanceof Error||!n?[e]:Array.isArray(n)?n.map(r=>r.message):[`${t.status} ${t.statusText}`]}catch(e){return console.warn("Couldn't parse API response for error, using status code instead",e),[`${t.status} ${t.statusText}`]}}var y="52.0",O=t=>({getManagedContentVersion:n=>M({...n,...t})});async function M({managedContentId:t,channelId:e,organizationId:n,instanceUrl:r,apiVersion:o,querystringParams:a}){r.startsWith("https://")||(r="https://"+r);let C=o||y,s=a?a.toString():"",i=`${r}/cms/delivery/v${C}/${e}/contents/${t}?oid=${n}&${s}`;return(await x(i)).items[0]}async function x(t,e="GET",n="application/json"){let o=await fetch(t,{method:e,headers:{"Content-Type":n||"application/json"}});if(!o.ok){let a=await f(o);throw new Error(`Error ${e}ing request to Salesforce CMS (url: ${t}) (contentType: ${n}) (statusCode: ${o.status}) : ${a.join(", ")}`)}return await o.json()}export{R as CANVAS_SFCMS_PARAMETER_TYPES,O as createSalesforceCMSClient,F as createSalesforceCMSEnhancer,y as defaultSFCMSApiVersion};
