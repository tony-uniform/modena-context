{"version":3,"file":"storage-utils.js","sources":["../../../analytics-util-storage-global/dist/analytics-util-global-storage.module.js","../../../analytics-util-storage-cookie/dist/analytics-util-cookie.module.js","../../../analytics-util-storage-local/dist/analytics-util-localstorage.module.js","../../../analytics-util-types/dist/analytics-util-types.module.js","../../src/utils/parse.js","../../src/index.js"],"sourcesContent":["var l=\"object\"==typeof self&&self.self===self&&self||\"object\"==typeof global&&global.global===global&&global||void 0,e=\"undefined\";function o(e){return l[e]}function f(e,o){return l[e]=o,o}function n(l){f(l)}export{o as get,l as globalContext,n as remove,f as set,e as undef};\n//# sourceMappingURL=analytics-util-global-storage.module.js.map\n","import{undef as e,remove as t,set as o,get as n}from\"@analytics/global-storage-utils\";var i=a(),r=p,c=p;function u(e){return i?p(e,\"\",-1):t(e)}function a(){if(typeof i!==e)return i;try{p(\"__x\",\"__x\"),i=-1!==document.cookie.indexOf(\"__x\"),u(\"__x\")}catch(e){i=!1}return i}function p(t,r,c,u,a,p){if(typeof window!==e){var d=arguments.length>1;return i||(d?o(t,r):n(t)),d?document.cookie=t+\"=\"+encodeURIComponent(r)+(c?\"; expires=\"+new Date(+new Date+1e3*c).toUTCString()+(u?\"; path=\"+u:\"\")+(a?\"; domain=\"+a:\"\")+(p?\"; secure\":\"\"):\"\"):decodeURIComponent(((\"; \"+document.cookie).split(\"; \"+t+\"=\")[1]||\"\").split(\";\")[0])}}export{r as getCookie,a as hasCookies,u as removeCookie,c as setCookie};\n//# sourceMappingURL=analytics-util-cookie.module.js.map\n","import{undef as t,get as e,set as o,remove as r}from\"@analytics/global-storage-utils\";var a=l();function l(){if(typeof a!==t)return a;a=!0;try{typeof localStorage!==t&&typeof JSON!==t||(a=!1),localStorage.setItem(t,t),localStorage.removeItem(t)}catch(t){a=!1}return a}function n(t){return a?localStorage.getItem(t):e(t)}function c(t,e){return a?localStorage.setItem(t,e):o(t,e)}function u(t){return a?localStorage.removeItem(t):r(t)}export{n as getItem,l as hasLocalStorage,u as removeItem,c as setItem};\n//# sourceMappingURL=analytics-util-localstorage.module.js.map\n","var t=\"function\",n=\"string\",e=\"undefined\",r=\"boolean\",o=\"object\",u=\"array\",i=\"number\",f=function(){},c=\"undefined\"!=typeof window;function a(t){return\"function\"==typeof t}function l(t){return\"string\"==typeof t}function p(t){return\"number\"==typeof t&&!isNaN(t)}function y(t){return void 0===t}function s(t){return\"boolean\"==typeof t}function d(t){return null===t}function g(t){return\"[object Array]\"===Object.prototype.toString.call(t)}function b(t){if(\"object\"!=typeof t||null===t)return!1;for(var n=t;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return Object.getPrototypeOf(t)===n}function m(t){return t instanceof RegExp}function O(t){if(!a(t))return!1;var n=/{(\\r|\\n|\\s)*}/gm,e=f.toString();return e===(t.toString().match(n)||[\"\"])[0].replace(n,e)}function A(t){return!(l(t)&&\"false\"===t.toLowerCase()||!t)}function j(t){return!(t.length>320)&&/^[a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(t)}function z(t){return NodeList.prototype.isPrototypeOf(t)}function Z(t){return t instanceof Element||t instanceof HTMLDocument}function v(t){return Z(t)&&\"FORM\"===t.nodeName}function S(t,n){if(!t||\"hidden\"===getComputedStyle(t).visibility)return!0;for(;t;){if(null!=n&&t===n)return!1;if(\"none\"===getComputedStyle(t).display)return!0;t=t.parentElement}return!1}export{u as ARRAY,r as BOOLEAN,t as FUNCTION,i as NUMBER,o as OBJECT,n as STRING,e as UNDEFINED,g as isArray,s as isBoolean,c as isBrowser,Z as isElement,j as isEmail,v as isForm,a as isFunction,S as isHidden,O as isNoOp,z as isNodeList,d as isNull,p as isNumber,b as isObject,m as isRegex,l as isString,A as isTruthy,y as isUndefined,f as noOp};\n//# sourceMappingURL=analytics-util-types.module.js.map\n","import { isObject } from '@analytics/type-utils'\n/**\n * Safe JSON parse\n * @param  {*} input - value to parse\n * @return {*} parsed input\n */\nexport default function parse(input) {\n  let value = input\n  try {\n    value = JSON.parse(input)\n    if (value === 'true') return true\n    if (value === 'false') return false\n    if (isObject(value)) return value\n    if (parseFloat(value) === value) {\n      value = parseFloat(value)\n    }\n  } catch (e) { }\n  if (value === null || value === \"\") {\n    return\n  }\n  return value\n}\n","import { set, get, remove, globalContext } from '@analytics/global-storage-utils'\nimport { getCookie, setCookie, removeCookie, hasCookies } from '@analytics/cookie-utils'\nimport { hasLocalStorage } from '@analytics/localstorage-utils'\nimport { isUndefined, isString } from '@analytics/type-utils'\nimport parse from './utils/parse'\n\n// Constants\nexport const ALL = '*'\nexport const ANY = 'any'\nexport const LOCAL_STORAGE = 'localStorage'\nexport const COOKIE = 'cookie'\nexport const GLOBAL = 'global'\n\n// Verify support\nconst hasStorage = hasLocalStorage()\nconst hasCookiesSupport = hasCookies()\n\n/**\n * Get storage item from localStorage, cookie, or window\n * @param  {string} key - key of item to get\n * @param  {object|string} [options] - storage options. If string location of where to get storage\n * @param  {string} [options.storage] - Define type of storage to pull from.\n * @return {Any}  the value of key\n */\nexport function getItem(key, options) {\n  if (!key) return\n  const type = getStorageType(options)\n  const getFirst = !useAll(type)\n\n  /* 1. Try localStorage */\n  const localValue = useLocal(type) ? parse(localStorage.getItem(key)) : undefined\n  if (getFirst && !isUndefined(localValue)) {\n    return localValue\n  }\n\n  /* 2. Fallback to cookie */\n  const cookieVal = useCookie(type) ? parse(getCookie(key)) : undefined\n  if (getFirst && cookieVal) {\n    return cookieVal\n  }\n\n  /* 3. Fallback to window/global. */\n  const globalValue = get(key)\n\n  return getFirst ? globalValue : {\n    localStorage: localValue,\n    cookie: cookieVal,\n    global: globalValue\n  }\n}\n\n/**\n * Store values in localStorage, cookie, or window\n * @param {string} key - key of item to set\n * @param {*} value - value of item to set\n * @param {object|string} [options] - storage options. If string location of where to get storage\n * @param {string} [options.storage] - Define type of storage to pull from.\n * @returns {object} returns old value, new values, & location of storage\n */\nexport function setItem(key, value, options) {\n  if (!key || isUndefined(value)) {\n    return\n  }\n  const data = {}\n  const type = getStorageType(options)\n  const saveValue = JSON.stringify(value)\n  const setFirst = !useAll(type)\n\n  /* 1. Try localStorage */\n  if (useLocal(type)) {\n    // console.log('SET as localstorage', saveValue)\n    data[LOCAL_STORAGE] = {\n      location: LOCAL_STORAGE,\n      current: value, \n      previous: parse(localStorage.getItem(key))\n    }\n    // Set LocalStorage item\n    localStorage.setItem(key, saveValue)\n    if (setFirst) {\n      return data[LOCAL_STORAGE]\n    }\n  }\n  /* 2. Fallback to cookie */\n  if (useCookie(type)) {\n    // console.log('SET as cookie', saveValue)\n    data[COOKIE] = {\n      location: COOKIE,\n      current: value,\n      previous: parse(getCookie(key))\n    }\n    // Set Cookie\n    setCookie(key, saveValue)\n    if (setFirst) {\n      return data[COOKIE]\n    }\n  }\n  /* 3. Fallback to window/global */\n  data[GLOBAL] = {\n    location: GLOBAL, \n    current: value,\n    previous: get(key)\n  }\n  // Set global value\n  set(key, value)\n  // Return set value(s)\n  return (setFirst) ? data[GLOBAL] : data\n}\n\n/**\n * Remove values from localStorage, cookie, or window\n * @param {string} key - key of item to set\n * @param {object|string} [options] - storage options. If string location of where to get storage\n * @param {string} [options.storage] - Define type of storage to pull from.\n */\nexport function removeItem(key, options) {\n  if (!key) return\n  const type = getStorageType(options)\n  const values = getItem(key, ALL)\n\n  const data = {}\n  if (!isUndefined(values.localStorage) && useLocal(type)) {\n    /* 1. Try localStorage */\n    localStorage.removeItem(key)\n    data[LOCAL_STORAGE] = values.localStorage\n  }\n  if (!isUndefined(values.cookie) && useCookie(type)) {\n    /* 2. Fallback to cookie */\n    removeCookie(key)\n    data[COOKIE] = values.cookie\n  }\n  /* 3. Fallback to window/global */\n  if (!isUndefined(values.global) && useGlobal(type)) {\n    remove(key)\n    data[GLOBAL] = values.global\n  }\n  return data\n}\n\nfunction getStorageType(opts) {\n  if (!opts) return ANY\n  return isString(opts) ? opts : opts.storage\n}\n\nfunction useGlobal(storage) {\n  return useType(storage, GLOBAL)\n}\n\nfunction useLocal(storage) {\n  // If has localStorage and storage option not defined, or is set to 'localStorage' or '*'\n  return hasStorage && useType(storage, LOCAL_STORAGE)\n}\n\nfunction useCookie(storage) {\n  // If has cookies and storage option not defined, or is set to 'cookies' or '*'\n  return hasCookiesSupport && useType(storage, COOKIE)\n}\n\nfunction useAll(storage) {\n  return storage === ALL || storage === 'all'\n}\n\nfunction useType(storage, type) {\n  return (storage === ANY || storage === type || useAll(storage))\n}\n\nexport {\n  getCookie,\n  setCookie,\n  removeCookie,\n  globalContext,\n  hasLocalStorage,\n  hasCookies\n}\n\nexport default {\n  setItem,\n  getItem,\n  removeItem\n}"],"names":["globalContext","self","global","undef","get","key","set","value","remove","isSupported","hasCookies","getCookie","cookie","setCookie","removeCookie","name","document","indexOf","e","ttl","path","domain","secure","window","isSet","arguments","length","encodeURIComponent","Date","toUTCString","decodeURIComponent","split","hasLocalStorage","localStorage","JSON","setItem","removeItem","err","isUndefined","x","parse","input","obj","proto","Object","getPrototypeOf","isObject","parseFloat","ANY","LOCAL_STORAGE","COOKIE","GLOBAL","hasStorage","hasCookiesSupport","getItem","options","type","getStorageType","getFirst","useAll","localValue","useLocal","undefined","cookieVal","useCookie","globalValue","data","saveValue","stringify","setFirst","location","current","previous","values","useType","opts","storage"],"mappings":"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"}